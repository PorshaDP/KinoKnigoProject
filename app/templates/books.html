<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/styles/fonts.css">
    <link rel="stylesheet" href="static/styles/style-books.css">
    <title>Лента книг</title>
</head>

<body>

    <header class="header">
        <div class="container">
            <div class="wrapper">
                <div class="left-section">
                    <img src="static/images/логотип.png" class="logo" />
                    <span class="name">two <br>chairs</span>
                </div>
                <div class="main-section">
                    <form id="searchForm">
                        <input type="text" class="search-bar" id="searchInput" placeholder="Поиск книг...">
                        <button type="submit" hidden></button>
                    </form>
                </div>
                <div class="right-section">
                    <div>
                        <a href="/profile">
                            <img class="avatar" src="https://cdn.ebaumsworld.com/mediaFiles/picture/1151541/84693449.png" alt="Avatar">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="wrapper">
                <div class="left-section">
                    <nav class="navigation">
                        <a class="navigation-item" href="/main">Домой</a>
                        <a class="navigation-item active" href="/books">Книги</a>
                        <a class="navigation-item" href="/movies">Фильмы</a>
                        <a class="navigation-item" href="/get_horoscope">Гороскоп</a>
                        <a class="navigation-item" href="/random">Мне повезет</a>
                    </nav>
                </div>

                <div class="main-section">
                    <div id="bookCards" class="cards">
                        <!-- Динамически добавляемые карточки -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Обработчик для формы поиска книг
        document.getElementById('searchForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Предотвращаем отправку формы
            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm.trim()) {
                const books = await fetchRecommendations(searchTerm);
                displayBooks(books);
            }
        });

        // Функция для получения рекомендаций книг
        async function fetchRecommendations(query) {
            try {
                const response = await fetch('/recommend_books', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title: query, num_recommendations: 12 })
                });
                const data = await response.json();
                return data || [];
            } catch (error) {
                console.error('Ошибка при получении данных:', error);
                return [];
            }
        }

        // Функция для отображения карточек книг
        function displayBooks(books) {
            const bookCardsContainer = document.getElementById('bookCards');
            bookCardsContainer.innerHTML = ''; // Очищаем контейнер перед добавлением новых книг

            if (books.length === 0) {
                bookCardsContainer.innerHTML = '<p>Нет книг для отображения.</p>';
            } else {
                books.forEach(book => {
                    const card = createBookCard(book);
                    bookCardsContainer.appendChild(card);
                });
            }
        }

        // Функция для создания карточки книги
        function createBookCard(book) {
            const card = document.createElement('div');
            card.classList.add('card');

            // Верхняя часть карточки с изображением
            const cardTop = document.createElement('div');
            cardTop.classList.add('card__top');
            const image = document.createElement('img');
            image.classList.add('card__image');
            image.src = book.thumbnail || 'static/images/профиль.png'; // Если изображения нет, используем дефолтное
            cardTop.appendChild(image);

            // Нижняя часть карточки с информацией
            const cardBottom = document.createElement('div');
            cardBottom.classList.add('card__bottom');
            
            // Название книги
            const title = document.createElement('span');
            title.classList.add('card_title');
            title.textContent = book.title || 'Без названия';
            cardBottom.appendChild(title);

            // Автор книги
            const authors = document.createElement('p');
            authors.classList.add('card_authors');
            authors.textContent = `Автор: ${book.authors || 'Неизвестен'}`;
            cardBottom.appendChild(authors);

            // Описание книги
            const description = document.createElement('p');
            description.classList.add('card_description');
            description.textContent = book.description || 'Описание отсутствует';
            cardBottom.appendChild(description);

            // Рейтинг книги
            const rating = document.createElement('div');
            rating.classList.add('rating');
            const starIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            starIcon.setAttribute("class", "rating-icon");
            starIcon.setAttribute("width", "24");
            starIcon.setAttribute("height", "24");
            starIcon.setAttribute("viewBox", "0 0 24 24");
            starIcon.setAttribute("fill", "currentColor");
            starIcon.innerHTML = '<path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z" />';
            const ratingValue = document.createElement('span');
            ratingValue.textContent = book.average_rating || 'Неизвестен';
            rating.appendChild(starIcon);
            rating.appendChild(ratingValue);
            cardBottom.appendChild(rating);

            // Кнопка "Подробнее"
            const button = document.createElement('button');
            button.classList.add('card_button');
            button.textContent = 'Подробнее';
            cardBottom.appendChild(button);

            card.appendChild(cardTop);
            card.appendChild(cardBottom);

            return card;
        }
    </script>

</body>

</html>
